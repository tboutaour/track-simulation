import unittest
import pandas as pd
from track_analyzer.entities.track_point import TrackPoint as Point
from track_analyzer.interactor.get_trackanalysis_dataframe_impl import GetTrackAnalysisDataframeImpl


class MyTestCase(unittest.TestCase):
    def test_path_creation(self):
        get_track_analysis = GetTrackAnalysisDataframeImpl()
        id_track = 'activity_3276836874.gpx'
        input_projection_data = [
            [Point(39.56737690112559, 2.623551736100968), 1248507104, 317813195],
            [Point(39.567396665239926, 2.6235503246574017), 1248507104, 317813195],
            [Point(39.567452765194815, 2.6235463183093786), 1248507104, 317813195],
            [Point(39.567486468136444, 2.6235439114319785), 1248507104, 317813195],
            [Point(39.56752217252739, 2.623541361622155), 1248507104, 317813195],
            [Point(39.56753953026663, 2.6235401220285683), 1248507104, 317813195],
            [Point(39.56756115302965, 2.6235385778506086), 1248507104, 317813195],
            [Point(39.56758207879942, 2.623537083448046), 1248507104, 317813195],
            [Point(39.567647900169014, 2.623532382850435), 1248507104, 317813195],
            [Point(39.567667170041275, 2.6235310067028994), 1248507104, 317813195]]

        input_track_data = [
            [Point(39.56738345324993, 2.623643483966589)],
            [Point(39.56740231253207, 2.623629402369261)],
            [Point(39.56745771691203, 2.6236156560480595)],
            [Point(39.56749141216278, 2.623613141477108)],
            [Point(39.56752711907029, 2.6236106269061565)],
            [Point(39.56754421815276, 2.623605765402317)],
            [Point(39.56756575964391, 2.623603083193302)],
            [Point(39.56758629530668, 2.6235961262136698)],
            [Point(39.567651925608516, 2.623588750138879)],
            [Point(39.56767112016678, 2.623586319386959)]]

        result = get_track_analysis.apply(id_track,
                                          input_track_data,
                                          input_projection_data)
        expected_data = pd.DataFrame([
            ['activity_3276836874.gpx', 2.623643483966589, 39.56738345324993,
            2.623551736100968, 39.56737690112559, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.623629402369261, 39.56740231253207,
            2.6235503246574017, 39.567396665239926, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.6236156560480595, 39.56745771691203,
            2.6235463183093786, 39.567452765194815, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.623613141477108, 39.56749141216278,
            2.6235439114319785, 39.567486468136444, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.6236106269061565, 39.56752711907029,
            2.623541361622155, 39.56752217252739, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.623605765402317, 39.56754421815276,
            2.6235401220285683, 39.56753953026663, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.623603083193302, 39.56756575964391,
            2.6235385778506086, 39.56756115302965, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.6235961262136698, 39.56758629530668,
            2.623537083448046, 39.56758207879942, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.623588750138879, 39.567651925608516,
            2.623532382850435, 39.567647900169014, 1248507104, 317813195],
            ['activity_3276836874.gpx', 2.623586319386959, 39.56767112016678,
            2.6235310067028994, 39.567667170041275, 1248507104, 317813195]],
            columns=['id', 'Point_lat', 'Point_lon', 'Projection_lat', 'Projection_lon', 'Origin', 'Target'])
        pd.testing.assert_frame_equal(result, expected_data)
